package helpers;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.util.HashMap;

import org.apache.http.HttpResponse;
import org.apache.http.client.ClientProtocolException;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpGet;
import org.apache.http.client.methods.HttpPost;
import org.apache.http.client.utils.URIBuilder;
import org.apache.http.impl.client.HttpClientBuilder;
import org.json.JSONObject;

public class HTTPHelper {
	final String HOST = "www.reddit.com";
	final String SCHEME = "http";
	HttpClient client = HttpClientBuilder.create().build();
	HttpPost postRequest = new HttpPost();
	HttpGet getRequest = new HttpGet();
	URIBuilder builder = new URIBuilder();
	
	public HTTPHelper() {
		builder.setScheme(SCHEME);
		builder.setHost(HOST);
	}
	
	public JSONObject makeGetRequest(String path, HashMap<String, String> parameters, HashMap<String, String> headers) {
		builder.clearParameters();
		getRequest.reset();
		if(parameters != null) {
			for(String key : parameters.keySet()) {
				builder.setParameter(key, parameters.get(key));
			}
		}
		
		if(headers != null) {
			for(String key : headers.keySet()) {
				getRequest.addHeader(key, headers.get(key));
			}
		}
		
		URI uri = builder.build();
		String resultText = "";
		
		try {
			HttpResponse response = client.execute(getRequest);
			BufferedReader reader = new BufferedReader(new InputStreamReader(response.getEntity().getContent()));
			StringBuffer result = new StringBuffer();
			String line = "";
			while((line = reader.readLine()) != null) {
				result.append(line);
			}
			resultText = result.toString();
		} catch (ClientProtocolException e) {
			e.printStackTrace();
		} catch (IOException e) {
			e.printStackTrace();
		}
		
		System.out.println(resultText);
		JSONObject resultJson = new JSONObject(resultText);
		
		
		return resultJson;
		
	}
}
